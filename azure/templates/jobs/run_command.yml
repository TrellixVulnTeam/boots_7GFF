jobs:
- job: run_command
  condition: contains(dependencies.BOOTS_ENVIRONMENTS.outputs['v.v'], '|$(parameters.environment)')
  dependsOn: BOOTS_ENVIRONMENTS
  displayName: $(parameters.displayName)
  pool:
    vmImage: $(vmImage)
  steps:
  - task: UsePythonVersion@0
    inputs:
      architecture: $(architecture)
      versionSpec: $(versionSpec)
  - template: ../steps/in_archive_from_artifact.yml
  - bash: $(BOOTS_COMMAND)
    displayName: Run Command
  - task: CopyFiles@2
    inputs:
      contents: requirements/*.txt
      targetFolder: $(Build.ArtifactStagingDirectory)
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: results
      pathToPublish: $(Build.ArtifactStagingDirectory)
  strategy:
    matrix:
      linux_python_3_6_x64:
        architecture: x64
        displayName: 'Linux: Python 3.6-x64'
        environment: Linux_3.6-x64
        job: linux_python_3_6_x64
        platform: Linux
        versionSpec: '3.6'
        vmImage: ubuntu-16.04
      linux_python_3_7_x64:
        architecture: x64
        displayName: 'Linux: Python 3.7-x64'
        environment: Linux_3.7-x64
        job: linux_python_3_7_x64
        platform: Linux
        versionSpec: '3.7'
        vmImage: ubuntu-16.04
      macos_python_3_6_x64:
        architecture: x64
        displayName: 'macOS: Python 3.6-x64'
        environment: macOS_3.6-x64
        job: macos_python_3_6_x64
        platform: macOS
        versionSpec: '3.6'
        vmImage: macOS-10.13
      macos_python_3_7_x64:
        architecture: x64
        displayName: 'macOS: Python 3.7-x64'
        environment: macOS_3.7-x64
        job: macos_python_3_7_x64
        platform: macOS
        versionSpec: '3.7'
        vmImage: macOS-10.13
      windows_python_3_6_x64:
        architecture: x64
        displayName: 'Windows: Python 3.6-x64'
        environment: Windows_3.6-x64
        job: windows_python_3_6_x64
        platform: Windows
        versionSpec: '3.6'
        vmImage: vs2017-win2016
      windows_python_3_7_x64:
        architecture: x64
        displayName: 'Windows: Python 3.7-x64'
        environment: Windows_3.7-x64
        job: windows_python_3_7_x64
        platform: Windows
        versionSpec: '3.7'
        vmImage: vs2017-win2016
