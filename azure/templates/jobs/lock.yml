jobs:
  - job: lock_${{ parameters.platform }}_${{ parameters.versionSpec }}_${{ parameters.architecture }}
    displayName: Lock ${{ parameters.platform }} ${{ parameters.versionSpec }} ${{ parameters.architecture }}
    dependsOn: ${{ parameters.dependsOn }}
    pool:
      vmImage: ${{ parameters.vmImage }}
    strategy:
      matrix:
        3.6:
          versionSpec: '3.6'
          architecture: 'x64'
          artifact_id: ${{ parameters.artifact_id }}_0
    steps:
      - task: UsePythonVersion@0
        inputs:
          versionSpec: $(versionSpec)
          architecture: $(architecture)
      - template: ../steps/in_archive_from_artifact.yml
      - bash: |
          python boots.py lock
        displayName: Lock
      - bash: |
          tar --create --gzip --file lock.tar.gz requirements/*.txt
        displayName: Tar lock files
      - task: PublishPipelineArtifact@0
        inputs:
          artifactName: $(artifact_id)
          targetPath: 'lock.tar.gz'
